#product-info  {
    product-name: "libpng";
    version: "1.5.4";
    original-source-location: "http://surfnet.dl.sourceforge.net/project/libpng/libpng15/1.5.4/lpng154.zip";
    original-source-website: "http://www.libpng.org/";
    license: "Custom - see LICENSE for details";
    packager: "Hamish C";
}


x86 {
    compiler: vc10;
	platform: x86;

	requires: {
		"zlib-dev[vc10]-1.2.5-x86-1e373a58e25250cb",
	};
	
    targets: { 
        "projects\vstudio\Release\libpng15.dll",
        "projects\vstudio\Release\libpng15.lib",
		"projects\vstudio\Release\pngvalid.exe",
    };
     
    build-command:@"
       msbuild /p:Platform=Win32 /p:Configuration=Release projects\vstudio\vstudio.sln
    ";
     
    clean-command:@"
        pushd projects\vstudio\libpng
        del /Q *.user  2>NUL
        rmdir /S /Q Release 2>NUL
        popd
        pushd projects\vstudio\pnglibconf
        del /Q *.user  2>NUL
        rmdir /S /Q Release 2>NUL
        popd
        pushd projects\vstudio\pngtest
        del /Q *.user  2>NUL
        rmdir /S /Q Release 2>NUL
        popd
        pushd projects\vstudio\pngvalid
        del /Q *.user  2>NUL
        rmdir /S /Q Release 2>NUL
        popd
        pushd projects\vstudio\zlib
        del /Q *.user  2>NUL
        rmdir /S /Q Release 2>NUL
        popd

        pushd projects\vstudio
        del /Q *.sdf *.suo *.user  2>NUL
        rmdir /S /Q Release 2>NUL
        popd

        del /Q pnglibconf.h  2>NUL
    ";
};

release {
	uses: x86;
}

test {
	uses: release;
	
	build-command: @"
		projects\vstudio\Release\pngvalid.exe || goto failed
	";
}
